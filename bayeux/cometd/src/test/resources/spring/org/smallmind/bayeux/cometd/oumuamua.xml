<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns="http://www.springframework.org/schema/beans"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd">

  <bean id="oumuamuaServer" class="org.smallmind.bayeux.cometd.OumuamuaServer">
    <constructor-arg index="0" name="serverBackbone">
      <bean class="org.smallmind.bayeux.cometd.backbone.kafka.KafkaBackbone">
        <constructor-arg index="0" name="nodeName" value="pod"/>
        <constructor-arg index="1" name="concurrencyLimit" value="1"/>
        <constructor-arg index="2" name="topicName" value="oumuamua"/>
        <constructor-arg index="3" name="servers">
          <list>
            <bean class="org.smallmind.bayeux.cometd.backbone.kafka.KafkaServer">
              <property name="host" value="localhost"/>
              <property name="port" value="9094"/>
            </bean>
          </list>
        </constructor-arg>
      </bean>
    </constructor-arg>
    <constructor-arg index="1" name="configuration">
      <bean class="org.smallmind.bayeux.cometd.OumuamuaConfiguration">
        <property name="transports">
          <list>
            <bean class="org.smallmind.bayeux.cometd.transport.LocalTransport">
              <constructor-arg index="0" name="configuration">
                <bean class="org.smallmind.bayeux.cometd.transport.LocalTransportConfiguration"/>
              </constructor-arg>
            </bean>
            <bean class="org.smallmind.bayeux.cometd.transport.WebSocketTransport">
              <constructor-arg index="0" name="oumuamuaUrl" value="/cometd/*"/>
              <constructor-arg index="1" name="configuration">
                <bean class="org.smallmind.bayeux.cometd.transport.WebSocketTransportConfiguration"/>
              </constructor-arg>
            </bean>
            <bean class="org.smallmind.bayeux.cometd.transport.LongPollingTransport">
              <constructor-arg index="0" name="configuration">
                <bean class="org.smallmind.bayeux.cometd.transport.LongPollingTransportConfiguration"/>
              </constructor-arg>
            </bean>
          </list>
        </property>
        <property name="allowedTransports">
          <list>
            <value>local</value>
            <value>websocket</value>
            <value>long-polling</value>
          </list>
        </property>
        <property name="maximumMessageQueueSize" value="1000"/>
      </bean>
    </constructor-arg>
  </bean>

  <bean id="oumuamuaServerListenerInstaller" class="org.smallmind.web.grizzly.installer.ListenerInstaller">
    <property name="contextPath" value="/smallmind"/>
    <property name="eventListener">
      <bean class="org.smallmind.bayeux.cometd.OumuamuaServletContextListener">
        <property name="oumuamuaServer" ref="oumuamuaServer"/>
      </bean>
    </property>
  </bean>

  <bean id="cometdServletInstaller" class="org.smallmind.web.grizzly.installer.ServletInstaller">
    <property name="contextPath" value="/smallmind"/>
    <property name="displayName" value="cometd"/>
    <property name="servletClass" value="org.smallmind.bayeux.cometd.OumuamuaServlet"/>
    <property name="urlPattern" value="/cometd/*"/>
    <property name="loadOnStartup" value="1"/>
    <property name="asyncSupported" value="true"/>
  </bean>
</beans>
