<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns="http://www.springframework.org/schema/beans"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd">

  <bean id="oumuamuaServer" class="org.smallmind.bayeux.oumuamua.server.impl.OumuamuaServer">
    <constructor-arg index="0" name="configuration">
      <bean class="org.smallmind.bayeux.oumuamua.server.impl.OumuamuaConfiguration">
        <property name="codec">
          <bean class="org.smallmind.bayeux.oumuamua.server.spi.json.orthodox.OrthodoxCodec">
            <constructor-arg index="0" name="deserializer">
              <bean class="org.smallmind.bayeux.oumuamua.server.spi.json.jackson.JacksonDeserializer"/>
            </constructor-arg>
          </bean>
        </property>
        <property name="protocols">
          <list>
            <bean class="org.smallmind.bayeux.oumuamua.server.spi.websocket.jsr356.WebsocketProtocol">
              <constructor-arg index="0" name="longPollingIntervalMilliseconds" value="30000"/>
              <constructor-arg index="1" name="websocketConfiguration">
                <bean class="org.smallmind.bayeux.oumuamua.server.spi.websocket.jsr356.WebsocketConfiguration">
                  <constructor-arg index="0" name="endpointClass" value="org.smallmind.bayeux.oumuamua.server.impl.websocket.WebSocketEndpoint"/>
                  <constructor-arg index="1" name="oumuamuaUrl" value="/cometd/*"/>
                </bean>
              </constructor-arg>
            </bean>
          </list>
        </property>
      </bean>
    </constructor-arg>
  </bean>

  <bean id="oumuamuaServerListenerInstaller" class="org.smallmind.web.grizzly.installer.ListenerInstaller">
    <property name="contextPath" value="/smallmind"/>
    <property name="eventListener">
      <bean class="org.smallmind.bayeux.oumuamua.server.impl.OumuamuaServletContextListener">
        <property name="oumuamuaServer" ref="oumuamuaServer"/>
      </bean>
    </property>
  </bean>

  <bean id="cometdServletInstaller" class="org.smallmind.web.grizzly.installer.ServletInstaller">
    <property name="contextPath" value="/smallmind"/>
    <property name="displayName" value="cometd"/>
    <property name="servletClass" value="org.smallmind.bayeux.oumuamua.server.impl.OumuamuaServlet"/>
    <property name="urlPattern" value="/cometd/*"/>
    <property name="loadOnStartup" value="1"/>
    <property name="asyncSupported" value="true"/>
  </bean>
</beans>
