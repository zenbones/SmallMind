<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.springframework.org/schema/beans
           http://www.springframework.org/schema/beans/spring-beans-3.0.xsd">

  <import resource="classpath:org/smallmind/instrument/metric.xml"/>

  <!-- Collect Spring Initialized Hibernate Resources -->
  <bean class="org.smallmind.persistence.orm.spring.hibernate.HibernateAnnotationSeekingBeanFactoryPostProcessor">
    <property name="markedAnnotations">
      <list>
        <value>javax.persistence.Entity</value>
      </list>
    </property>
  </bean>

  <bean class="org.smallmind.persistence.orm.spring.hibernate.HibernateFileSeekingBeanFactoryPostProcessor"/>

  <bean id="persistence" class="org.smallmind.persistence.Persistence" init-method="register">
    <constructor-arg index="0">
      <bean class="org.smallmind.nutsnbolts.reflection.type.converter.DefaultStringConverterFactory"/>
    </constructor-arg>
    <constructor-arg index="1">
      <bean class="org.smallmind.instrument.config.MetricConfiguration">
        <property name="instrumented" value="${orm.statistics}"/>
        <property name="metricDomain">
          <bean class="org.smallmind.instrument.config.PackageMetricDomain">
            <constructor-arg index="0" value="org.smallmind.persistence.instrument.MetricSource"/>
          </bean>
        </property>
      </bean>
    </constructor-arg>
  </bean>

  <!-- AspectJ Transaction Management -->
  <bean id="transactionManagerAspect" class="org.smallmind.persistence.orm.aop.TransactionalAspect" factory-method="aspectOf"/>

</beans>